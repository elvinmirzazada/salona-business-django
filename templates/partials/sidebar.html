{% load static %}
{% load i18n %}

<!-- Flowbite Sidebar -->
<aside id="sidebar" class="fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full sm:translate-x-0" aria-label="Sidebar">
   <div class="h-full px-3 py-4 overflow-y-auto bg-gradient-to-b from-gray-900 via-purple-900 to-violet-900">
      <!-- Logo Header -->
      <a href="{% url 'users:dashboard' %}" class="flex items-center ps-2.5 mb-5">
         <img src="{% static 'images/salona-icon-without-bg.png' %}" class="h-10 me-3 sm:h-12" alt="Salona Logo">
         <span class="self-center text-2xl font-semibold whitespace-nowrap text-white">Salona</span>
      </a>

      <!-- Main Navigation -->
      <ul class="space-y-2 font-medium">
         {% if company_id and user_data.role_status == 'active' %}

         <!-- Dashboard -->
         <li>
            <a href="{% url 'users:dashboard' %}" id="dashboard-nav" class="nav-link flex items-center p-2 text-gray-200 rounded-lg hover:bg-purple-800 group">
               <svg class="w-5 h-5 text-gray-300 transition duration-75 group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 21">
                  <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
               </svg>
               <span class="ms-3">{% trans "Dashboard" %}</span>
            </a>
         </li>

         <!-- Staff -->
         <li>
            <a href="{% url 'users:staff' %}" id="staff-nav" class="nav-link flex items-center p-2 text-gray-200 rounded-lg hover:bg-purple-800 group">
               <svg class="w-5 h-5 text-gray-300 transition duration-75 group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 18">
                  <path d="M14 2a3.963 3.963 0 0 0-1.4.267 6.439 6.439 0 0 1-1.331 6.638A4 4 0 1 0 14 2Zm1 9h-1.264A6.957 6.957 0 0 1 15 15v2a2.97 2.97 0 0 1-.184 1H19a1 1 0 0 0 1-1v-1a5.006 5.006 0 0 0-5-5ZM6.5 9a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9ZM8 10H5a5.006 5.006 0 0 0-5 5v2a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-2a5.006 5.006 0 0 0-5-5Z"/>
               </svg>
               <span class="flex-1 ms-3 whitespace-nowrap">{% trans "Staff" %}</span>
            </a>
         </li>

         <!-- Customers -->
         <li>
            <a href="{% url 'users:customers' %}" id="customers-nav" class="nav-link flex items-center p-2 text-gray-200 rounded-lg hover:bg-purple-800 group">
               <svg class="flex-shrink-0 w-5 h-5 text-gray-300 transition duration-75 group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z"/>
               </svg>
               <span class="flex-1 ms-3 whitespace-nowrap">{% trans "Customers" %}</span>
            </a>
         </li>

         <!-- Services -->
         <li>
            <a href="{% url 'users:services' %}" id="services-nav" class="nav-link flex items-center p-2 text-gray-200 rounded-lg hover:bg-purple-800 group">
               <svg class="flex-shrink-0 w-5 h-5 text-gray-300 transition duration-75 group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 20">
                  <path d="M17 5.923A1 1 0 0 0 16 5h-3V4a4 4 0 1 0-8 0v1H2a1 1 0 0 0-1 .923L.086 17.846A2 2 0 0 0 2.08 20h13.84a2 2 0 0 0 1.994-2.153L17 5.923ZM7 9a1 1 0 0 1-2 0V7h2v2Zm0-5a2 2 0 1 1 4 0v1H7V4Zm6 5a1 1 0 1 1-2 0V7h2v2Z"/>
               </svg>
               <span class="flex-1 ms-3 whitespace-nowrap">{% trans "Services" %}</span>
            </a>
         </li>

         <!-- Membership Plans -->
         <li>
            <a href="{% url 'users:membership_plans' %}" id="membership-plans-nav" class="nav-link flex items-center p-2 text-gray-200 rounded-lg hover:bg-purple-800 group">
               <svg class="flex-shrink-0 w-5 h-5 text-gray-300 transition duration-75 group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M11.074 4 8.442.408A.95.95 0 0 0 7.014.254L2.926 4h8.148ZM9 13v-1a4 4 0 0 1 4-4h6V6a1 1 0 0 0-1-1H1a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h17a1 1 0 0 0 1-1v-2h-6a4 4 0 0 1-4-4Z"/>
                  <path d="M19 10h-6a2 2 0 0 0-2 2v1a2 2 0 0 0 2 2h6a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1Zm-4.5 3.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2ZM12.62 4h2.78L12.539.41a1.086 1.086 0 1 0-1.7 1.352L12.62 4Z"/>
               </svg>
               <span class="flex-1 ms-3 whitespace-nowrap">{% trans "Membership" %}</span>
            </a>
         </li>

         <!-- Integrations -->
         <li>
            <a href="{% url 'users:integrations' %}" id="integrations-nav" class="nav-link flex items-center p-2 text-gray-200 rounded-lg hover:bg-purple-800 group">
               <svg class="flex-shrink-0 w-5 h-5 text-gray-300 transition duration-75 group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M5 5V.13a2.96 2.96 0 0 0-1.293.749L.879 3.707A2.96 2.96 0 0 0 .13 5H5Z"/>
                  <path d="M6.737 11.061a2.961 2.961 0 0 1 .81-1.515l6.117-6.116A4.839 4.839 0 0 1 16 2.141V2a1.97 1.97 0 0 0-1.933-2H7v5a2 2 0 0 1-2 2H0v11a1.969 1.969 0 0 0 1.933 2h12.134A1.97 1.97 0 0 0 16 18v-3.093l-1.546 1.546c-.413.413-.94.695-1.513.81l-3.4.679a2.947 2.947 0 0 1-1.85-.227 2.96 2.96 0 0 1-1.635-3.257l.681-3.397Z"/>
                  <path d="M8.961 16a.93.93 0 0 0 .189-.019l3.4-.679a.961.961 0 0 0 .49-.263l6.118-6.117a2.884 2.884 0 0 0-4.079-4.078l-6.117 6.117a.96.96 0 0 0-.263.491l-.679 3.4A.961.961 0 0 0 8.961 16Zm7.477-9.8a.958.958 0 0 1 .68-.281.961.961 0 0 1 .682 1.644l-.315.315-1.36-1.36.313-.318Zm-5.911 5.911 4.236-4.236 1.359 1.359-4.236 4.237-1.7.339.341-1.699Z"/>
               </svg>
               <span class="flex-1 ms-3 whitespace-nowrap">{% trans "Integrations" %}</span>
            </a>
         </li>

         <!-- Notifications with Badge -->
         <li>
            <a href="{% url 'users:notifications' %}" id="notifications-nav" class="nav-link flex items-center p-2 text-gray-200 rounded-lg hover:bg-purple-800 group relative">
               <svg class="flex-shrink-0 w-5 h-5 text-gray-300 transition duration-75 group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm3.982 13.982a1 1 0 0 1-1.414 0l-3.274-3.274A1.012 1.012 0 0 1 9 10V6a1 1 0 0 1 2 0v3.586l2.982 2.982a1 1 0 0 1 0 1.414Z"/>
               </svg>
               <span class="flex-1 ms-3 whitespace-nowrap">{% trans "Notifications" %}</span>
               {% if unread_notifications_count and unread_notifications_count > 0 %}
               <span id="notification-count" class="inline-flex items-center justify-center w-5 h-5 ms-3 text-xs font-semibold text-purple-900 bg-purple-200 rounded-full">
                  {{ unread_notifications_count }}
               </span>
               {% endif %}
            </a>
         </li>

         {% endif %}
      </ul>

      <!-- Footer Section -->
      <ul class="pt-4 mt-4 space-y-2 font-medium border-t border-purple-700">
         <!-- Settings -->
         <li>
            <a href="{% url 'users:settings' %}" id="settings-nav" class="nav-link flex items-center p-2 text-gray-200 rounded-lg hover:bg-purple-800 group">
               <svg class="flex-shrink-0 w-5 h-5 text-gray-300 transition duration-75 group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M18 7.5h-.423l-.452-1.09.3-.3a1.5 1.5 0 0 0 0-2.121L16.01 2.575a1.5 1.5 0 0 0-2.121 0l-.3.3-1.089-.452V2A1.5 1.5 0 0 0 11 .5H9A1.5 1.5 0 0 0 7.5 2v.423l-1.09.452-.3-.3a1.5 1.5 0 0 0-2.121 0L2.576 3.99a1.5 1.5 0 0 0 0 2.121l.3.3L2.423 7.5H2A1.5 1.5 0 0 0 .5 9v2A1.5 1.5 0 0 0 2 12.5h.423l.452 1.09-.3.3a1.5 1.5 0 0 0 0 2.121l1.415 1.413a1.5 1.5 0 0 0 2.121 0l.3-.3 1.09.452V18A1.5 1.5 0 0 0 9 19.5h2a1.5 1.5 0 0 0 1.5-1.5v-.423l1.09-.452.3.3a1.5 1.5 0 0 0 2.121 0l1.415-1.414a1.5 1.5 0 0 0 0-2.121l-.3-.3.452-1.09H18a1.5 1.5 0 0 0 1.5-1.5V9A1.5 1.5 0 0 0 18 7.5Zm-8 6a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Z"/>
               </svg>
               <span class="flex-1 ms-3 whitespace-nowrap">{% trans "Settings" %}</span>
            </a>
         </li>

         <!-- Language Selector -->
         <li>
            <form action="{% url 'set_language' %}" method="post" id="language-form" class="flex items-center p-2 text-gray-200 rounded-lg hover:bg-purple-800 group">
               {% csrf_token %}
               <input name="next" type="hidden" value="{{ request.get_full_path }}">
               <svg class="flex-shrink-0 w-5 h-5 text-gray-300 transition duration-75 group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M11.074 4 8.442.408A.95.95 0 0 0 7.014.254L2.926 4h8.148ZM9 13v-1a4 4 0 0 1 4-4h6V6a1 1 0 0 0-1-1H1a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h17a1 1 0 0 0 1-1v-2h-6a4 4 0 0 1-4-4Z"/>
                  <path d="M11.054 2h2.39l-2.91-3.56a1.086 1.086 0 1 0-1.7 1.352L11.054 2Z"/>
               </svg>
               {% get_current_language as CURRENT_LANGUAGE %}
               {% get_available_languages as AVAILABLE_LANGUAGES %}
               <select name="language" onchange="this.form.submit()" class="flex-1 ms-3 bg-transparent border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 p-1.5 hover:bg-purple-800 transition duration-75 cursor-pointer">
                  {% for lang_code, lang_name in AVAILABLE_LANGUAGES %}
                  <option value="{{ lang_code }}" {% if lang_code == CURRENT_LANGUAGE %}selected{% endif %} class="bg-gray-800 text-gray-200">
                     {{ lang_name }}
                  </option>
                  {% endfor %}
               </select>
            </form>
         </li>

         <!-- Fullscreen Toggle (Dashboard only) -->
         {% if user_data.role_status == 'active' %}
         {% if request.path == '/dashboard/' or '/dashboard' in request.path %}
         <li>
            <a href="#" id="fullscreen-nav" onclick="toggleFullscreen(event)" class="flex items-center p-2 text-gray-200 rounded-lg hover:bg-purple-800 group">
               <svg class="flex-shrink-0 w-5 h-5 text-gray-300 transition duration-75 group-hover:text-white fullscreen-icon-expand" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
               </svg>
               <svg class="flex-shrink-0 w-5 h-5 text-gray-300 transition duration-75 group-hover:text-white fullscreen-icon-collapse hidden" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
               </svg>
               <span class="flex-1 ms-3 whitespace-nowrap">{% trans "Fullscreen" %}</span>
            </a>
         </li>
         {% endif %}
         {% endif %}

         <!-- Logout -->
         <li>
            <a href="#" id="logout-nav" onclick="handleLogout(event)" class="flex items-center p-2 text-red-300 rounded-lg hover:bg-red-800 group">
               <svg class="flex-shrink-0 w-5 h-5 text-red-400 transition duration-75 group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 18 16">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 8h11m0 0L8 4m4 4-4 4m4-11h3a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-3"/>
               </svg>
               <span class="flex-1 ms-3 whitespace-nowrap">{% trans "Logout" %}</span>
            </a>
         </li>
      </ul>
   </div>
</aside>

{#<!-- Mobile Toggle Button -->#}
{#<button data-drawer-target="sidebar" data-drawer-toggle="sidebar" aria-controls="sidebar" type="button" class="inline-flex items-center justify-center p-2.5 text-sm rounded-lg sm:hidden focus:outline-none focus:ring-2 focus:ring-purple-300 transition-all duration-200 hover:scale-105">#}
{#   <span class="sr-only">{% trans "Open sidebar" %}</span>#}
{#   <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">#}
{#      <path clip-rule="evenodd" fill-rule="evenodd" d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z"></path>#}
{#   </svg>#}
{#</button>#}

<style>
/* Active navigation state */
.nav-link.active {
    background-color: rgb(107, 33, 168) !important;
    color: white !important;
}

.nav-link.active svg {
    color: white !important;
}

/* Fullscreen mode adjustments */
#sidebar.fullscreen-hidden {
    display: none !important;
}

.main-content.fullscreen-expanded {
    margin-left: 0 !important;
    width: 100% !important;
}

.sm\:ml-64.fullscreen-expanded {
    margin-left: 0 !important;
}

#exit-fullscreen-btn.visible {
    display: flex !important;
}

/* Ensure proper stacking for sidebar drawer */
[data-drawer-backdrop] {
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    z-index: 30;
}
</style>



<script>
// Initialize Flowbite components on page load
document.addEventListener('DOMContentLoaded', function() {
    // Set active navigation state
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link');

    navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') && currentPath.includes(link.getAttribute('href').split('/').filter(Boolean).pop())) {
            link.classList.add('active');
        }
    });

    // Specific path matching for better accuracy
    if (currentPath.includes('/dashboard')) {
        document.getElementById('dashboard-nav')?.classList.add('active');
    } else if (currentPath.includes('/staff')) {
        document.getElementById('staff-nav')?.classList.add('active');
    } else if (currentPath.includes('/customers')) {
        document.getElementById('customers-nav')?.classList.add('active');
    } else if (currentPath.includes('/services')) {
        document.getElementById('services-nav')?.classList.add('active');
    } else if (currentPath.includes('/membership-plans')) {
        document.getElementById('membership-plans-nav')?.classList.add('active');
    } else if (currentPath.includes('/integrations')) {
        document.getElementById('integrations-nav')?.classList.add('active');
    } else if (currentPath.includes('/notifications')) {
        document.getElementById('notifications-nav')?.classList.add('active');
    } else if (currentPath.includes('/settings')) {
        document.getElementById('settings-nav')?.classList.add('active');
    }
});

// Handle logout functionality
function handleLogout(event) {
    event.preventDefault();
    if (confirm('{% trans "Are you sure you want to logout?" %}')) {
        window.location.href = "{% url 'users:logout' %}";
    }
}

// Fullscreen functionality
function toggleFullscreen(event) {
    event.preventDefault();
    const elem = document.documentElement;

    if (!document.fullscreenElement && !document.webkitFullscreenElement &&
        !document.mozFullScreenElement && !document.msFullscreenElement) {
        // Enter fullscreen
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
        } else if (elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
        } else if (elem.msRequestFullscreen) {
            elem.msRequestFullscreen();
        }
    } else {
        exitFullscreen();
    }
}

function exitFullscreen() {
    if (document.exitFullscreen) {
        document.exitFullscreen();
    } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
    } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
    } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
    }
}

// Handle fullscreen changes
function handleFullscreenChange() {
    const sidebar = document.getElementById('sidebar');
    const mainContentWrapper = document.querySelector('.sm\\:ml-64');
    const mainContent = document.querySelector('.main-content');
    const exitButton = document.getElementById('exit-fullscreen-btn');
    const expandIcon = document.querySelector('.fullscreen-icon-expand');
    const collapseIcon = document.querySelector('.fullscreen-icon-collapse');

    if (document.fullscreenElement || document.webkitFullscreenElement ||
        document.mozFullScreenElement || document.msFullscreenElement) {
        // Entering fullscreen
        sidebar?.classList.add('fullscreen-hidden');
        mainContentWrapper?.classList.add('fullscreen-expanded');
        mainContent?.classList.add('fullscreen-expanded');
        exitButton?.classList.add('visible');
        if (expandIcon) expandIcon.classList.add('hidden');
        if (collapseIcon) collapseIcon.classList.remove('hidden');

        // Change time slot height for fullscreen mode
        document.documentElement.style.setProperty('--time-slot-height', '60px');
    } else {
        // Exiting fullscreen
        sidebar?.classList.remove('fullscreen-hidden');
        mainContentWrapper?.classList.remove('fullscreen-expanded');
        mainContent?.classList.remove('fullscreen-expanded');
        exitButton?.classList.remove('visible');
        if (expandIcon) expandIcon.classList.remove('hidden');
        if (collapseIcon) collapseIcon.classList.add('hidden');

        // Reset time slot height to default
        document.documentElement.style.setProperty('--time-slot-height', '36px');
    }
}

// Listen for fullscreen changes
document.addEventListener('fullscreenchange', handleFullscreenChange);
document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
document.addEventListener('mozfullscreenchange', handleFullscreenChange);
document.addEventListener('MSFullscreenChange', handleFullscreenChange);
</script>


