<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% load i18n %}Salona - {% trans "Notifications" %}</title>
    {% load static %}
    <link rel="icon" type="image/png" href="{% static 'images/salona-icon.png' %}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/notifications.css' %}">
    <link rel="stylesheet" href="{% static 'css/notification-page.css' %}">
    <link rel="stylesheet" href="{% static 'css/navigation.css' %}">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Flowbite CSS -->
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.css" rel="stylesheet" />

    <!-- Flowbite Overrides -->
    <link rel="stylesheet" href="{% static 'css/flowbite-overrides.css' %}">
</head>
<body>
    {% include 'partials/profile_image_modal.html' %}
    <!-- Full Page Loading Spinner -->
    <div id="page-loader" class="page-loader">
        <div class="loader-container">
            <div class="loader-spinner"></div>
            <p class="loader-text">{% trans "Loading notifications..." %}</p>
        </div>
    </div>

    <!-- 3D Background Shapes -->
    <div class="bg-shape bg-shape-1"></div>
    <div class="bg-shape bg-shape-2"></div>
    <div class="bg-shape bg-shape-3"></div>

    <!-- Include reusable sidebar -->
    {% include 'partials/sidebar.html' %}

    <!-- Main content area with Flowbite sidebar offset -->
    <div class="sm:ml-64">
        <main class="main-content p-4">
            <header class="header">
                <div class="header-left">
                    <button class="back-button" onclick="window.location.href='/users/dashboard/'">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2 class="page-title">{% trans "Notifications" %}</h2>
                </div>
                <div class="header-actions">
                    {% include 'partials/notification_icon.html' %}
                    {% include 'partials/user_welcome.html' %}
                </div>
            </header>

            <!-- Notifications content -->
            <div class="content-wrapper">
                <div class="notifications-container">
                    <div class="card-header notifications-header">
                        <div class="header-content">
                            <div class="header-text">
                                <h2 class="notifications-title">
                                    <i class="fas fa-bell notifications-icon"></i>
                                    {% trans "Notifications" %}
                                </h2>
                                <p class="notifications-subtitle">{% trans "View and manage your notifications" %}</p>
                            </div>
                            <div class="header-actions">
                                <button id="mark-all-read-btn" class="action-button primary">
                                    <i class="fas fa-check-double"></i>
                                    {% trans "Mark All Read" %}
                                </button>
                                <button id="refresh-notifications-btn" class="action-button secondary">
                                    <i class="fas fa-sync-alt"></i>
                                    {% trans "Refresh" %}
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card-body">
                        <!-- Notifications Stats -->
                        <div class="notifications-stats-bar">
                            <div class="stat-item">
                                <i class="fas fa-inbox"></i>
                                <span id="total-notifications">0</span>
                                <span class="stat-label">{% trans "Total" %}</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-envelope"></i>
                                <span id="unread-notifications">0</span>
                                <span class="stat-label">{% trans "Unread" %}</span>
                            </div>
                        </div>

                        <!-- Notifications Filter -->
                        <div class="notifications-filter">
                            <div class="filter-tabs">
                                <button class="filter-tab active" data-filter="all">
                                    <i class="fas fa-inbox"></i>
                                    {% trans "All" %}
                                </button>
                                <button class="filter-tab" data-filter="unread">
                                    <i class="fas fa-envelope"></i>
                                    {% trans "Unread" %}
                                </button>
                                <button class="filter-tab" data-filter="general">
                                    <i class="fas fa-info-circle"></i>
                                    {% trans "General" %}
                                </button>
                                <button class="filter-tab" data-filter="booking">
                                    <i class="fas fa-calendar"></i>
                                    {% trans "Booking" %}
                                </button>
                                <button class="filter-tab" data-filter="payment">
                                    <i class="fas fa-credit-card"></i>
                                    {% trans "Payment" %}
                                </button>
                            </div>
                        </div>

                        <!-- Alert messages -->
                        <div id="alert-container"></div>

                        <div class="notifications-table-container" id="notifications-table-container">
                            <div class="notifications-table">
                                <table id="notifications-table">
                                    <thead>
                                        <tr>
                                            <th>{% trans "Type" %}</th>
                                            <th>{% trans "Message" %}</th>
                                            <th>{% trans "Category" %}</th>
                                            <th>{% trans "Time" %}</th>
                                            <th>{% trans "Actions" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody id="notifications-tbody">
                                        <!-- Notifications rows will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="notifications-loading" class="loading-container" style="display:none;">
                            <div class="spinner"></div>
                        </div>

                        <div id="notifications-empty" class="empty-state" style="display:none;">
                            <div class="no-notifications">
                                <i class="fas fa-bell-slash"></i>
                                <p>{% trans "No notifications found. You're all caught up!" %}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Confirmation Dialog -->
    <div id="confirmation-dialog" class="confirmation-dialog" style="display: none;">
        <div class="confirmation-content">
            <div class="confirmation-header">
                <h3 id="confirmation-title">{% trans "Confirm Action" %}</h3>
            </div>
            <div class="confirmation-body">
                <p id="confirmation-message">{% trans "Are you sure you want to perform this action?" %}</p>
            </div>
            <div class="confirmation-actions">
                <button id="confirmation-cancel" class="action-button secondary">{% trans "Cancel" %}</button>
                <button id="confirmation-confirm" class="action-button danger">{% trans "Confirm" %}</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Get API_BASE_URL from Django template context (environment variable)
        window.API_BASE_URL = "{{ API_BASE_URL }}";
        window.userData = {{ user_data_json|safe }};

        // Pass translations to JavaScript
        window.notificationsTranslations = {
            notifications: "{% trans 'notifications' %}",
            notification: "{% trans 'notification' %}",
            unread: "{% trans 'unread' %}",
            total: "{% trans 'Total' %}",
            generalNotification: "{% trans 'General Notification' %}",
            bookingUpdate: "{% trans 'Booking Update' %}",
            bookingCreated: "{% trans 'Booking Created' %}",
            paymentNotification: "{% trans 'Payment Notification' %}",
            reminder: "{% trans 'Reminder' %}",
            alert: "{% trans 'Alert' %}",
            systemNotification: "{% trans 'System Notification' %}",
            read: "{% trans 'Read' %}",
            markAsRead: "{% trans 'Mark as read' %}",
            deleteNotification: "{% trans 'Delete notification' %}",
            deleteNotificationTitle: "{% trans 'Delete Notification' %}",
            deleteNotificationMessage: "{% trans 'Are you sure you want to delete this notification? This action cannot be undone.' %}",
            markAllAsReadTitle: "{% trans 'Mark All as Read' %}",
            markAllAsReadMessage: "{% trans 'Are you sure you want to mark all unread notifications as read?' %}",
            notificationMarkedAsRead: "{% trans 'Notification marked as read' %}",
            failedToMarkAsRead: "{% trans 'Failed to mark notification as read' %}",
            notificationDeleted: "{% trans 'Notification deleted successfully' %}",
            failedToDelete: "{% trans 'Failed to delete notification' %}",
            noUnreadNotifications: "{% trans 'No unread notifications to mark as read' %}",
            allMarkedAsRead: "{% trans 'All notifications marked as read' %}",
            failedToMarkAllAsRead: "{% trans 'Failed to mark all notifications as read' %}",
            errorLoadingNotifications: "{% trans 'Error loading notifications' %}",
            failedToLoad: "{% trans 'Failed to load notifications' %}",
            noNotifications: "{% trans 'No notifications found.' %}",
            loadingRecords: "{% trans 'Loading notifications...' %}",
            processing: "{% trans 'Processing...' %}",
            search: "{% trans 'Search notifications:' %}",
            lengthMenu: "{% trans 'Show _MENU_ entries' %}",
            info: "{% trans 'Showing _START_ to _END_ of _TOTAL_ notifications' %}",
            infoEmpty: "{% trans 'Showing 0 to 0 of 0 notifications' %}",
            infoFiltered: "{% trans '(filtered from _MAX_ total notifications)' %}",
            paginate: {
                first: "{% trans 'First' %}",
                last: "{% trans 'Last' %}",
                next: "{% trans 'Next' %}",
                previous: "{% trans 'Previous' %}"
            },
            general: "{% trans 'General' %}",
            booking: "{% trans 'Booking' %}",
            payment: "{% trans 'Payment' %}",
            type: "{% trans 'Type' %}",
            message: "{% trans 'Message' %}",
            category: "{% trans 'Category' %}",
            time: "{% trans 'Time' %}",
            actions: "{% trans 'Actions' %}"
        };

        // Mobile sidebar toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const sidebar = document.querySelector('.sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');

            if (mobileMenuToggle && sidebar && sidebarOverlay) {
                // Toggle sidebar on mobile menu button click
                mobileMenuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                    sidebarOverlay.classList.toggle('active');

                    // Reposition toggle button when sidebar is active
                    if (sidebar.classList.contains('active')) {
                        mobileMenuToggle.style.left = '295px'; // 280px sidebar + 15px spacing
                    } else {
                        mobileMenuToggle.style.left = '15px';
                    }
                });

                // Close sidebar when clicking overlay
                sidebarOverlay.addEventListener('click', function() {
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');
                    mobileMenuToggle.style.left = '15px'; // Reset position
                });

                // Close sidebar when clicking any nav item on mobile
                const navItems = sidebar.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    item.addEventListener('click', function() {
                        if (window.innerWidth <= 768) {
                            sidebar.classList.remove('active');
                            sidebarOverlay.classList.remove('active');
                            mobileMenuToggle.style.left = '15px'; // Reset position
                        }
                    });
                });

                // Handle window resize to properly hide/show mobile elements
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 768) {
                        sidebar.classList.remove('active');
                        sidebarOverlay.classList.remove('active');
                        mobileMenuToggle.style.left = '15px';
                    }
                });
            }
        });
    </script>

    <!-- Include JavaScript files -->
    {% load static %}
    <!-- jQuery (required for DataTables) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/2.3.5/features/scrollResize/dataTables.scrollResize.min.js"></script>

    <script src="{% static 'js/config.js' %}"></script>
    <script src="{% static 'js/api-client.js' %}"></script>
    <script src="{% static 'js/notifications.js' %}"></script>
    <script src="{% static 'js/notification-datatable.js' %}"></script>
    <!-- Font Awesome JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <!-- Flowbite JS -->
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.js"></script>
</body>
</html>
